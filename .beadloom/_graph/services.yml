nodes:
  # Root service
  - ref_id: beadloom
    kind: service
    summary: "Beadloom CLI + MCP server — Context Oracle + Doc Sync v2 Engine (v1.5.0)"
    source: src/beadloom/
    docs:
      - docs/architecture.md
      - docs/getting-started.md
      - docs/guides/ci-setup.md

  # Domain: Context Oracle
  - ref_id: context-oracle
    kind: domain
    summary: "Context bundle building via BFS graph traversal, code indexing, caching, search"
    source: src/beadloom/context_oracle/
    docs:
      - docs/domains/context-oracle/README.md

  # Domain: Doc Sync
  - ref_id: doc-sync
    kind: domain
    summary: "Doc-code synchronization tracking and stale detection"
    source: src/beadloom/doc_sync/
    docs:
      - docs/domains/doc-sync/README.md

  # Domain: Graph
  - ref_id: graph
    kind: domain
    summary: "YAML graph format, loader, diff, rule engine, import resolver, linter"
    source: src/beadloom/graph/
    docs:
      - docs/domains/graph/README.md

  # Domain: Onboarding
  - ref_id: onboarding
    kind: domain
    summary: "Project bootstrap, doc import, architecture-aware presets, doc generation"
    source: src/beadloom/onboarding/
    docs:
      - docs/domains/onboarding/README.md

  # Feature: Doc Generator
  - ref_id: doc-generator
    kind: feature
    summary: "Doc skeleton generation + AI polish data from architecture graph"
    source: src/beadloom/onboarding/doc_generator.py
    docs:
      - docs/domains/onboarding/features/doc-generator/SPEC.md

  # Domain: Infrastructure
  - ref_id: infrastructure
    kind: domain
    summary: "SQLite database layer, health metrics, reindex orchestrator"
    source: src/beadloom/infrastructure/
    docs:
      - docs/domains/infrastructure/README.md

  # Service: CLI
  - ref_id: cli
    kind: service
    summary: "Click-based CLI with 21 commands"
    source: src/beadloom/services/cli.py
    docs:
      - docs/services/cli.md

  # Service: MCP Server
  - ref_id: mcp-server
    kind: service
    summary: "MCP stdio server with 13 tools for AI agents"
    source: src/beadloom/services/mcp_server.py
    docs:
      - docs/services/mcp.md

  # Service: TUI
  - ref_id: tui
    kind: service
    summary: "Interactive terminal dashboard (Textual)"
    source: src/beadloom/tui/
    docs:
      - docs/services/tui.md

  # Feature: Doctor
  - ref_id: doctor
    kind: feature
    summary: "Validation checks for graph and data integrity"
    source: src/beadloom/infrastructure/doctor.py
    docs:
      - docs/domains/infrastructure/features/doctor/SPEC.md

  # Feature: Why (Impact Analysis)
  - ref_id: why
    kind: feature
    summary: "Impact analysis — upstream deps and downstream consumers via bidirectional BFS"
    source: src/beadloom/context_oracle/why.py
    docs:
      - docs/domains/context-oracle/features/why/SPEC.md

  # Feature: Watcher
  - ref_id: watcher
    kind: feature
    summary: "File watcher for auto-reindex on changes"
    source: src/beadloom/infrastructure/watcher.py
    docs:
      - docs/domains/infrastructure/features/watcher/SPEC.md

  # Feature: Search
  - ref_id: search
    kind: feature
    summary: "FTS5 full-text search across nodes and documentation"
    source: src/beadloom/context_oracle/search.py
    docs:
      - docs/domains/context-oracle/features/search/SPEC.md

  # Feature: Graph Diff
  - ref_id: graph-diff
    kind: feature
    summary: "Git ref comparison — added/removed/changed nodes and edges"
    source: src/beadloom/graph/diff.py
    docs:
      - docs/domains/graph/features/graph-diff/SPEC.md

  # Feature: Rule Engine
  - ref_id: rule-engine
    kind: feature
    summary: "Architecture-as-Code rule engine with require/deny rules"
    source: src/beadloom/graph/rule_engine.py
    docs:
      - docs/domains/graph/features/rule-engine/SPEC.md

  # Feature: Import Resolver
  - ref_id: import-resolver
    kind: feature
    summary: "Multi-language import analysis and depends_on edge generation"
    source: src/beadloom/graph/import_resolver.py
    docs:
      - docs/domains/graph/features/import-resolver/SPEC.md

  # Feature: C4 Architecture Diagrams
  - ref_id: c4-diagrams
    kind: feature
    summary: "C4 architecture model mapping with Mermaid and PlantUML renderers"
    source: src/beadloom/graph/c4.py
    docs:
      - docs/domains/graph/features/c4-diagrams/SPEC.md

  # Feature: Cache
  - ref_id: cache
    kind: feature
    summary: "ETag-based context bundle cache (in-memory + SQLite)"
    source: src/beadloom/context_oracle/cache.py
    docs:
      - docs/domains/context-oracle/features/cache/SPEC.md

  # Feature: Agent Prime
  - ref_id: agent-prime
    kind: feature
    summary: "Cross-IDE context injection via prime CLI/MCP + AGENTS.md + IDE adapters"
    source: src/beadloom/onboarding/scanner.py
    docs:
      - docs/domains/onboarding/features/agent-prime/SPEC.md

  # Feature: Reindex
  - ref_id: reindex
    kind: feature
    summary: "Full reindex pipeline — drop, recreate, reload graph/docs/code/sync"
    source: src/beadloom/infrastructure/reindex.py
    docs:
      - docs/domains/infrastructure/features/reindex/SPEC.md

edges:
  # Root service: self-referencing to satisfy service-needs-parent rule
  - src: beadloom
    dst: beadloom
    kind: part_of

  # Domains are part_of beadloom
  - src: context-oracle
    dst: beadloom
    kind: part_of
  - src: doc-sync
    dst: beadloom
    kind: part_of
  - src: graph
    dst: beadloom
    kind: part_of
  - src: onboarding
    dst: beadloom
    kind: part_of
  - src: infrastructure
    dst: beadloom
    kind: part_of

  # Services are part_of beadloom
  - src: cli
    dst: beadloom
    kind: part_of
  - src: mcp-server
    dst: beadloom
    kind: part_of
  - src: tui
    dst: beadloom
    kind: part_of
  - src: doctor
    dst: infrastructure
    kind: part_of
  - src: watcher
    dst: infrastructure
    kind: part_of

  - src: doc-generator
    dst: onboarding
    kind: part_of
  - src: agent-prime
    dst: onboarding
    kind: part_of

  # Features are part_of their parent domains
  - src: search
    dst: context-oracle
    kind: part_of
  - src: cache
    dst: context-oracle
    kind: part_of
  - src: why
    dst: context-oracle
    kind: part_of
  - src: graph-diff
    dst: graph
    kind: part_of
  - src: rule-engine
    dst: graph
    kind: part_of
  - src: import-resolver
    dst: graph
    kind: part_of
  - src: c4-diagrams
    dst: graph
    kind: part_of
  - src: reindex
    dst: infrastructure
    kind: part_of

  # Service → domain usage edges
  - src: cli
    dst: context-oracle
    kind: uses
  - src: cli
    dst: doc-sync
    kind: uses
  - src: cli
    dst: graph
    kind: uses
  - src: cli
    dst: onboarding
    kind: uses
  - src: cli
    dst: infrastructure
    kind: uses
  - src: mcp-server
    dst: context-oracle
    kind: uses
  - src: mcp-server
    dst: doc-sync
    kind: uses
  - src: mcp-server
    dst: graph
    kind: uses
  - src: mcp-server
    dst: infrastructure
    kind: uses
  - src: mcp-server
    dst: onboarding
    kind: uses

  # Cross-domain dependencies
  - src: context-oracle
    dst: infrastructure
    kind: depends_on
  - src: doc-sync
    dst: infrastructure
    kind: depends_on
  - src: graph
    dst: infrastructure
    kind: depends_on
  - src: reindex
    dst: context-oracle
    kind: uses
  - src: reindex
    dst: doc-sync
    kind: uses
  - src: reindex
    dst: graph
    kind: uses
